<!-- src/main/resources/templates/fragments/reviewItem.html -->
<div th:fragment="reviewItem(title, content, author, date, rating, images, menus, likes, comments, id)">
    <div class="review-item">
        <button class="report-button" style="padding-top: 5px; float: right;" id="reviewReport">ğŸ””ì‹ ê³ í•˜ê¸°</button>
        <h4 class="review-title" th:text="${title}">ë¦¬ë·° ì œëª©</h4>
        <div class="review-header">
            <div class="review-text">
                <p th:text="${content}">ë¦¬ë·° ë‚´ìš©</p>
            </div>
            <div class="review-info">
                <span class="reviewer-name" th:text="${author}">ì‘ì„±ì</span>
                <span class="review-date" th:text="${date}">ì‘ì„±ì¼</span>
                <div class="rating" th:text="${rating}">í‰ì </div>
            </div>
        </div>
<!--        <div class="review-images">-->
<!--            &lt;!&ndash; TODO: ì´ë¯¸ì§€ í‘œì‹œ ë¡œì§ êµ¬í˜„-->
<!--                 - ì´ë¯¸ì§€ ëª©ë¡ì„ ìˆœíšŒí•˜ë©° í‘œì‹œ-->
<!--                 - ì´ë¯¸ì§€ í¬ê¸° ì¡°ì • ë° ë ˆì´ì•„ì›ƒ ìµœì í™”-->
<!--                 - ì´ë¯¸ì§€ í´ë¦­ ì‹œ í™•ëŒ€ ê¸°ëŠ¥ ì¶”ê°€ &ndash;&gt;-->
<!--&lt;!&ndash;            <img th:src=@{${images.filePath}} src="https://via.placeholder.com/150" alt="Review Image 1" class="review-image">&ndash;&gt;-->
<!--&lt;!&ndash;            <img src="https://via.placeholder.com/150" alt="Review Image 2" class="review-image">&ndash;&gt;-->
<!--&lt;!&ndash;            <img src="https://via.placeholder.com/150" alt="Review Image 3" class="review-image">&ndash;&gt;-->

<!--            <img th:each="image : ${images}" th:src="@{|https://kr.object.ncloudstorage.com/whiskey-file/${image.imageFile.uuidFileName}|}" alt="Review Image" class="review-image">-->
<!--&lt;!&ndash;            <img src="https://kr.object.ncloudstorage.com/whiskey-file/279278f9-41d5-408c-b477-0850bd1a8c41.jpg" alt="Review Image 3" class="review-image">&ndash;&gt;-->
<!--            <div class="more-images">-->
<!--                <span>+ ë”ë³´ê¸°</span>-->
<!--            </div>-->
<!--        </div>-->

<!--        <div class="review-images" th:if="${images.size() > 0}">-->
<!--            <div class="image-container">-->
<!--                <img th:each="image, iterStat : ${images}"-->
<!--                     th:if="${iterStat.index < 4}"-->
<!--                     th:src="@{|https://kr.object.ncloudstorage.com/whiskey-file/${image.imageFile.uuidFileName}|}"-->
<!--                     alt="Review Image"-->
<!--                     class="review-image">-->

<!--                &lt;!&ndash; ë”ë³´ê¸° ë²„íŠ¼ ì¡°ê±´ &ndash;&gt;-->
<!--                <div th:if="${images.size() > 4}" class="more-images">-->
<!--                    <span>+ ë”ë³´ê¸°</span>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->

        <div class="review-images" th:if="${images.size() > 0}">
            <div class="image-container" style="display: flex; gap: 10px; flex-wrap: wrap;">
                <div th:each="image, iterStat : ${images}" th:if="${iterStat.index < 4}">
                    <img th:src="@{|https://kr.object.ncloudstorage.com/whiskey-file/${image.imageFile.uuidFileName}|}"
                         alt="Review Image"
                         class="review-image">
                </div>

                <!-- ë”ë³´ê¸° ë²„íŠ¼ ì¡°ê±´ -->
                <div th:if="${images.size() > 4}" class="more-images">
                    <span>+ ë”ë³´ê¸°</span>
                </div>
            </div>
        </div>


        <div class="menu-info">
<!--            <span class="menu-name">ë©”ë‰´ ì´ë¦„</span>-->
<!--            <span class="menu-price">ë©”ë‰´ ê°€ê²©</span>-->

<!--            <span class="menu-name"><p th:text="${menu.itemName}"></p></span>-->
<!--            <span class="menu-price">ë©”ë‰´ ê°€ê²©</span>-->

            <div th:each="menu : ${menus.paidItems}">
                <span th:text="${'ë©”ë‰´ ì´ë¦„: ' + menu.itemName + ' / '}">ë©”ë‰´ ì´ë¦„</span>
                <span th:text="${'ë‹¨ê°€: ' + menu.price + 'ì› / '}">ë©”ë‰´ ê°€ê²©</span>
<!--                <span th:text="${'ë‹¨ê°€: ' + #numbers.formatDecimal(menu.price, 0, '###,###') + 'ì› / '}">ë©”ë‰´ ê°€ê²©</span>-->
                <span th:text="${'ìˆ˜ëŸ‰: ' + menu.quantity}">ë©”ë‰´ ì´ë¦„</span>
            </div>

<!--            <p class="menu-name" th:text="${'ë©”ë‰´ ì´ë¦„: ' + menu.itemName}">ë©”ë‰´ ì´ë¦„</p>-->
<!--            <p class="menu-price" th:text="${'ë‹¨ê°€: ' + menu.price + 'ì›'}">ë©”ë‰´ ê°€ê²©</p>-->
<!--            <p class="menu-name" th:text="${'ìˆ˜ëŸ‰: ' + menu.quantity}">ë©”ë‰´ ì´ë¦„</p>-->

<!--            <p th:text="${'ì´ ê¸ˆì•¡: ' + menus.totalPrice}"}></p>-->
        </div>
        <div class="review-actions">
<!--            <button class="like-button">ğŸ‘ ì¢‹ì•„ìš” (15)</button>-->
            <button th:id="${'review-like-button-' + id}" class="like-button" >
                <span th:text="'ğŸ‘ ì¢‹ì•„ìš” (' + ${likes.size()} + ')'"></span>
            </button>
<!--            <button class="dislike-button">ğŸ‘ ì‹«ì–´ìš” (2)</button>-->
<!--            <button class="comment-button">ğŸ’¬ ëŒ“ê¸€ (3)</button>-->
            <button class="comment-button">
                <span th:id="'comment-button-' + ${id}" th:text="'ğŸ’¬ ëŒ“ê¸€ (' + ${comments.size()} + ')'"></span>
            </button>

<!--            <button class="comment-button"><span th:text="ğŸ’¬ ëŒ“ê¸€${reviewCommentCount}"></span></button>-->
        </div>
        <div class="comments-section" style="display: none;">
            <div class="comments-list" th:id="'commentsBox' + ${id}">
                <!-- TODO: ëŒ“ê¸€ ëª©ë¡ í‘œì‹œ ë¡œì§ êµ¬í˜„
                     - ëŒ“ê¸€ ë°ì´í„°ë¥¼ ì„œë²„ì—ì„œ ê°€ì ¸ì™€ ë™ì ìœ¼ë¡œ í‘œì‹œ<div class="comment" th:each="comment : ${comments}">
                    <p th:text="${comment.content}"></p>
                    <button class="report-button" style="float: right;" id="commentReport">ğŸ””ì‹ ê³ í•˜ê¸°</button>
                    <span th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd')} + ' / ' + ${comment.commenter.nickname}"></span>
                </div>
                     - í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„
                     - ëŒ“ê¸€ ì •ë ¬ ê¸°ëŠ¥ ì¶”ê°€ (ìµœì‹ ìˆœ, ì¶”ì²œìˆœ ë“±) -->
                <!-- ì˜ˆì‹œ ëŒ“ê¸€ -->
                <div class="comment" th:each="comment : ${comments}">
                    <p th:text="${comment.content}"></p>
                    <button class="report-button" style="float: right;" id="commentReport">ğŸ””ì‹ ê³ í•˜ê¸°</button>
                    <span th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd')} + ' / ' + ${comment.commenter.nickname}"></span>
                </div>
<!--                <div class="comment" th:each="comment : ${comments}">-->
<!--                    <p th:text="${comment.content}"></p>-->
<!--&lt;!&ndash;                    <a th:href="/report/${comment.id}"></a>&ndash;&gt;-->
<!--&lt;!&ndash;                    <span th:text="${comment.formated}"></span>&ndash;&gt;-->
<!--                </div>-->
<!--                <div class="comment">-->
<!--                    <p>ì •ë§ ë§›ìˆì–´ ë³´ì´ë„¤ìš”! ê¼­ ê°€ë³´ê³  ì‹¶ìŠµë‹ˆë‹¤.</p>-->
<!--                    <button style="float: right;" id="commentReport">ì‹ ê³ í•˜ê¸°</button> &lt;!&ndash; ì´ ë²„íŠ¼ë„ ê°™ì´ ë¶€íƒë“œë¦´ê²Œìš© &ndash;&gt;-->
<!--                    <span>ê¹€ì² ìˆ˜ - 2024-05-20</span>-->
<!--                </div>-->
<!--                <div class="comment">-->
<!--                    <p>íŠ¸ëŸ¬í”Œ í¬ë¦¼ íŒŒìŠ¤íƒ€ ì €ë„ ë¨¹ì–´ë´¤ëŠ”ë° ì •ë§ ë§›ìˆì—ˆì–´ìš”!</p>-->
<!--                    <span>ì´ì˜í¬ - 2024-05-21</span>-->
<!--                </div>-->
<!--                <div class="comment">-->
<!--                    <p>ê°€ê²©ëŒ€ë¹„ ì–‘ì€ ì–´ë–¤ê°€ìš”?</p>-->
<!--                    <span>ë°•ì§€ì„± - 2024-05-22</span>-->

<!--                </div>-->
            </div>
            <div class="comment-form">
                <textarea th:id="'comment' + ${id}" class="comment-input" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
<!--                <button class="submit-comment" th:onclick="submitComment()">ëŒ“ê¸€ ì‘ì„±</button>-->
                <!-- TODO: ëŒ“ê¸€ ì‘ì„± ê¸°ëŠ¥ êµ¬í˜„
                     - ëŒ“ê¸€ ë‚´ìš© ìœ íš¨ì„± ê²€ì‚¬
                     - ëŒ“ê¸€ ì‘ì„± API ì—°ë™
                     - ì‘ì„± ì™„ë£Œ í›„ ëŒ“ê¸€ ëª©ë¡ ê°±ì‹  -->
<!--                <button class="submit-comment" th:onclick="submitComment()">ëŒ“ê¸€ ì‘ì„±</button>-->
                <button class="submit-comment"
                        th:onclick="'submitCommentAsync(' + ${id} + ')'">
                    ëŒ“ê¸€ ì‘ì„±
                </button>
            </div>
        </div>
    </div>
    <script>
        function submitCommentAsync(reviewId) {
            // public ResponseEntity<List<ReviewComment>> addComment(@RequestBody ReviewCommentAddRequestModel reviewComment, HttpSession s

            /*
            <div class="comment" th:each="comment : ${comments}">
                    <p th:text="${comment.content}"></p>
                    <button class="report-button" style="float: right;" id="commentReport">ğŸ””ì‹ ê³ í•˜ê¸°</button>
                    <span th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd')} + ' / ' + ${comment.commenter.nickname}"></span>
                </div>

             ì €ì¥ í›„ ëŒ“ê¸€ ëª©ë¡ì„ ê°±ì‹ í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
             ìœ„ ì—˜ë¦¬ë¨¼íŠ¸ ë¶€ë¶„ì„ ìƒˆë¡œ ê°€ì ¸ì˜¤ëŠ” ë¦¬ìŠ¤íŠ¸ ê°’ìœ¼ë¡œ ëŒ€ì¹˜í•´ì•¼ í•¨.
             */
            console.log(`ëŒ“ê¸€ ì œì¶œ: ${reviewId}\n`);
            const commentContent = document.getElementById('comment' + reviewId).value;
            console.log(`ëŒ“ê¸€ ë‚´ìš©: ${commentContent}`);

            $.ajax({
                type: 'POST',
                url: '/review/comment/add',
                contentType: 'application/json',  // Content-Typeì„ JSONìœ¼ë¡œ ì§€ì •
                data: JSON.stringify({
                    reviewId: reviewId,
                    content: commentContent
                }),
                success: function (data) {
                    console.log(data);

                    // ì…ë ¥ì°½ì„ ë¹„ìš´ë‹¤.
                    document.getElementById('comment' + reviewId).value = '';

                    // ëŒ“ê¸€ ëª©ë¡ì„ ê°±ì‹ í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
                    // const commentsList = document.querySelector('.comments-list');
                    const commentsList = document.getElementById('commentsBox' + reviewId);
                    commentsList.innerHTML = '';

                    //commentbuttonë„ ìµœì‹ í™”
                    const commentButton = document.getElementById('comment-button-' + reviewId);
                    commentButton.innerText = `ğŸ’¬ ëŒ“ê¸€ (${data.length})`;

                    data.forEach(comment => {
                        const commentElement = document.createElement('div');
                        commentElement.classList.add('comment');

                        const commentContent = document.createElement('p');
                        commentContent.innerText = comment.content;
                        commentElement.appendChild(commentContent);

                        const reportButton = document.createElement('button');
                        reportButton.classList.add('report-button');
                        reportButton.style.float = 'right';
                        reportButton.innerText = 'ğŸ””ì‹ ê³ í•˜ê¸°';
                        commentElement.appendChild(reportButton);

                        const commentInfo = document.createElement('span');
                        commentInfo.innerText = `${comment.createdAt} / ${comment.commenter.nickname}`;
                        commentElement.appendChild(commentInfo);

                        commentsList.appendChild(commentElement);
                    });

                    // data.forEach(comment => {
                    //     const commentElement = document.createElement('div');
                    //     commentElement.classList.add('comment');
                    //
                    //     const commentContent = document.createElement('p');
                    //     commentContent.innerText = comment.content;
                    //     commentElement.appendChild(commentContent);
                    //
                    //     const reportButton = document.createElement('button');
                    //     reportButton.classList.add('report-button');
                    //     reportButton.style.float = 'right';
                    //     reportButton.innerText = 'ğŸ””ì‹ ê³ í•˜ê¸°';
                    //     commentElement.appendChild(reportButton);
                    //
                    //     const commentInfo = document.createElement('span');
                    //     commentInfo.innerText = `${comment.createdAt} / ${comment.commenter.nickname}`;
                    //     commentElement.appendChild(commentInfo);
                    //
                    //     commentsList.appendChild(commentElement);
                    // });
                }
            });
        }
        // document.addEventListener('DOMContentLoaded', function () {
        //
        // });

        // document.addEventListener('click', function (e) {
        //     if (e.target && e.target.classList.contains('like-button')) {
        //         const reviewId = e.target.id.split('-')[3];
        //         console.log(reviewId);
        //
        //         $.ajax({
        //             type: 'POST',
        //             url: '/review/like',
        //             data: {reviewId: reviewId},
        //             success: function (data) {
        //                 e.target.innerHTML = 'ğŸ‘ ì¢‹ì•„ìš” (' + data + ')';
        //             }
        //         });
        //     }
        // });
        // like-button í´ë˜ìŠ¤ë¥¼ ì°¾ì•„ í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
        // í•´ë‹¹ ì´ë²¤íŠ¸ ë‚´ì—ì„œ review-like-button- ë’¤ì˜ ìˆ«ìë¥¼ ì¶”ì¶œí•˜ì—¬ reviewId ë³€ìˆ˜ì— í• ë‹¹í•©ë‹ˆë‹¤.
        // reviewIdë¥¼ ì´ìš©í•´ ì„œë²„ë¡œ ì¢‹ì•„ìš” ìš”ì²­ì„ ë³´ë‚´ê³ , ì„±ê³µ ì‹œ ì‘ë‹µ ë°ì´í„°ë¥¼ ì´ìš©í•´ ì¢‹ì•„ìš” ë²„íŠ¼ì˜ í…ìŠ¤íŠ¸ë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤.
        // í•´ë‹¹ì‚¬í•­ ì—†ì„ê²½ìš° ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë‚´ì—ì„œ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        // document.addEventListener('click', function (e) {
        //     if (e.target && e.target.classList.contains('like-button')) {
        //         const reviewId = e.target.id.split('-')[3];
        //         console.log(reviewId);
        //
        //         $.ajax({
        //             type: 'POST',
        //             url: '/review/like',
        //             data: {reviewId: reviewId},
        //             success: function (data) {
        //                 e.target.innerHTML = 'ğŸ‘ ì¢‹ì•„ìš” (' + data + ')';
        //             }
        //         });
        //     }
        // });
    </script>
</div>


